var app=angular.module("myapp",["ngRoute","ngSanitize","angular.css.injector","ngTouch","ui.bootstrap"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"articlesCtrl"}).when("/profil/:id",{templateUrl:"views/profil.html",controller:"profilCtrl"}).when("/profil/:id/:page",{templateUrl:"views/profil.html",controller:"profilCtrl"}).when("/contact",{templateUrl:"views/contact.html"}).when("/connexion",{templateUrl:"views/connexion.html"}).when("/actualites",{templateUrl:"views/home.html",controller:"articlesCtrl"}).when("/realisations",{templateUrl:"views/home.html",controller:"articlesCtrl"}).when("/inscription",{templateUrl:"views/inscription.html"}).when("/identification",{templateUrl:"views/identification.html",controller:"identificationCtrl"}).when("/photos",{templateUrl:"views/photos.html",controller:"photosCtrl"}).when("/trouverPro",{templateUrl:"views/trouverPro.html",controller:"articlesCtrl"}).when("/profilPro",{templateUrl:"views/profilPro.html",controller:"profilProCtrl"}).when("/profilPro/vueEnsemble",{templateUrl:"views/profilPro.html",controller:"profilProCtrl"}).when("/profilPro/photoProjet",{templateUrl:"views/profilPro.html",controller:"profilProCtrl"}).when("/profilPro/servicesPro",{templateUrl:"views/profilPro.html",controller:"profilProCtrl"}).otherwise({redirectTo:"/"})}]),app.run(["$rootScope","ConfigFactory",function(a,b){a.filter={},a.config={},a.menuToggle={},a.config.loader=!1,b.getTrad().then(function(b){a.config.trad=b})}]),app.filter("range",function(){return function(a,b){b=parseInt(b);for(var c=1;b>=c;c++)a.push(c);return a}}),app.filter("traduction",["$rootScope",function(a){return function(b,c){return("DESC"==b||"ASC"==b)&&(b=c+"_"+b),"0"==b&&(b="1"),"undefined"==typeof b||"undefined"==typeof a.config.trad||"undefined"==typeof a.config.trad[b]?b:a.config.trad[b]}}]),app.filter("getCSS",function(){return function(a){return"undefined"==typeof a?"commun.min":a}}),app.filter("replaceCharacter",function(){return function(a){return a.replace(/\r\n/g,"<br>").replace(/\t/g,"&nbsp&nbsp&nbsp&nbsp").replace("[PUB]"," ").replace("[NOPUB]"," ")}}),app.filter("dedoublonne",function(){return function(a){if(void 0==a)return[];for(var b=[],c=[],d=0;d<a.length;d++)void 0==b[a[d]]&&(b[a[d]]=a[d],c.push(a[d]));return c}}),app.factory("ArticleFactory",["$http","$rootScope","$q",function(a,b,c){var d={articles:!1,filterOld:"",article:[],themes:!1,entity_types:!1,type_realisations:!1,type_travaux:!1,rubriques:!1,nbArtMax:30,nbPub:6,entity_default:"article_edito OR reseau_realisation",emplacementPub:function(a){return a>0?a%Math.floor(d.nbArtMax/d.nbPub)==0:!1},getArticles:function(e){b.config.loader=!0;var f=c.defer();if("undefined"!=typeof e&&angular.toJson(e)!=d.filterOld&&(d.filterOld=angular.toJson(e),d.articles=!1),d.articles!==!1)f.resolve(d.articles),b.config.loader=!1;else{var g="http://demo.batiactu.info/webServiceSolarium/solarium3/scripts/ws.php?nb_item="+d.nbArtMax,h="date";"undefined"!=typeof e&&"undefined"!=typeof e.keywords?(g=g+"&KEYWORDS="+e.keywords,h="score"):h="date","undefined"!=typeof e&&"undefined"!=typeof e.sort_order&&(h="date"),"undefined"!=typeof e&&"undefined"!=typeof e.score&&(h="score"),g=g+"&SORT_ORDER="+h+"|DESC","undefined"!=typeof e&&"undefined"!=typeof e.theme&&(g=g+"&themeFILTER="+encodeURIComponent(e.theme)),g="undefined"!=typeof e&&"undefined"!=typeof e.entity_type&&""!==e.entity_type?g+"&ENTITY="+e.entity_type:g+"&ENTITY="+d.entity_default,"undefined"!=typeof e&&"undefined"!=typeof e.page&&(g=g+"&N="+e.page),"undefined"!=typeof e&&"undefined"!=typeof e.type_realisation&&(g=g+"&type_realFILTER="+e.type_realisation),"undefined"!=typeof e&&"undefined"!=typeof e.type_trav&&(g=g+"&type_travFILTER="+e.type_trav),a.get(g).success(function(a,c){d.articles=a,"undefined"!=typeof a&&"undefined"!=typeof a.facets&&"undefined"!=typeof a.facets.theme&&(d.themes=a.facets.theme),"undefined"!=typeof a&&"undefined"!=typeof a.facets&&"undefined"!=typeof a.facets.rubrique&&(d.rubriques=a.facets.rubrique),"undefined"!=typeof a&&"undefined"!=typeof a.facets&&"undefined"!=typeof a.facets.entity_type&&(d.entity_types=[],angular.forEach(a.facets.entity_type,function(a){d.entity_types.push(a)})),"undefined"!=typeof a&&"undefined"!=typeof a.facets&&"undefined"!=typeof a.facets.type_realisation&&(d.type_realisations=a.facets.type_realisation),"undefined"!=typeof a&&"undefined"!=typeof a.facets&&"undefined"!=typeof a.facets.type_trav&&(d.type_travaux=a.facets.type_trav),""==d.articles&&(d.articles="Désolé, votre recherche n'a pas abouti."),f.resolve(d.articles),b.config.loader=!1}).error(function(a,b){f.reject("Impossible de récupérer les articles")})}return f.promise},getArticle:function(b){var e=c.defer();return void 0!==d.article[b]?e.resolve(d.article[b]):a.get("http://demo.batiactu.info/webServiceSolarium/solarium3/scripts/ws.php?ID="+b).success(function(a,c){d.article[b]=a.items,e.resolve(d.article[b])}).error(function(a,b){e.reject("Impossible de récupérer les articles")}),e.promise},getThemes:function(){var a=c.defer();return setTimeout(function(){a.resolve(d.themes)},2e3),a.promise},getEntityTypes:function(){var a=c.defer();return setTimeout(function(){a.resolve(d.entity_types)},2e3),a.promise},getType_realisations:function(){var a=c.defer();return setTimeout(function(){a.resolve(d.type_realisations)}),a.promise},getType_travaux:function(){var a=c.defer();return setTimeout(function(){a.resolve(d.type_travaux)}),a.promise},getRubriques:function(){var a=c.defer();return setTimeout(function(){a.resolve(d.rubriques)}),a.promise}};return d}]),app.factory("ConfigFactory",["$http","$q",function(a,b){var c={res:{},URLConfTrad:"scripts/config/trad.json",getTrad:function(){var c=b.defer();return a.get(this.URLConfTrad).success(function(a,b){this.res=a,c.resolve(this.res)}).error(function(a,b){c.reject("Impossible de récupérer la traduction")}),c.promise}};return c}]),app.factory("PubFactory",["$http","$q",function(a,b){var c={pubs:!1,URLpub:"http://capinfoproreport.batiactu.com/cap_pub/scripts/get-pub-support-emplacement.php?e=DROITE1&date=20150429&JSON",getPubs:function(){var d=b.defer();return c.pubs!==!1?d.resolve(c.pubs):a.get(c.URLpub).success(function(a,b){angular.forEach(a,function(a,b){-1==a.fichier.indexOf("swf")&&""!=a.fichier&&(0==c.pubs&&(c.pubs=[]),c.pubs.push(a))}),d.resolve(c.pubs)}).error(function(a,b){d.reject("Impossible de récupérer les pubs")}),d.promise},getPub:function(d){var e=b.defer();return void 0!==c.pub[d]?e.resolve(c.pub[d]):a.get("http://capinfoproreport.batiactu.com/cap_pub/scripts/get-pub-support-emplacement.php?&ID="+d).success(function(a,b){c.pub[d]=a.items,e.resolve(c.pub[d])}).error(function(a,b){e.reject("Impossible de récupérer les pubs")}),e.promise}};return c}]),app.controller("profilCtrl",["$scope","ArticleFactory","$log","$routeParams","$location","$route",function(a,b,c,d,e,f){a.article=!1,a.$location=e,a.$log=c,a.page=void 0==d.page?1:d.page,a.$routeParams=d,a.unArticle={},b.getArticle(d.id).then(function(b){"undefined"==typeof b?a.article={}:(a.article=b[0],a.unArticle=a.fromJJson(a.article.zs_json))}),a.fromJJson=function(a){return angular.fromJson(a)},a.comptePage=function(a){return null==a||void 0==a?"":a.length+1},a.int_val=function(a){return parseInt(a)},a.changeTemplate=function(a){return"views/templates/"+a+".html"},a.lienPhoto=function(a,b){var c;for(c=0;c<a.length;c++)if(parseInt(a[c].page)==b){var d=(a[c].photo.fichier1,a[c].taille);return{toto:4,fichier:a[c].photo.fichier1,taille:d}}return{}},a.imgResize=function(a){return a.replace("medium","medium_auto/300-200-c")},a.clicImage=function(a){return a.replace("medium","big")},a.precSuiv=function(){var a,c=-1,e="",f="",g="",h="",i="",j="";if(b.articles){if(void 0==b.articles.items)return{};for(a=0;a<b.articles.items.length;a++)b.articles.items[a].id==d.id&&(c=a);if(0==c){if(void 0!=b.articles.items&&void 0!=b.articles.items[c+1]){var h=b.articles.items[c+1].id,i=b.articles.items[c+1].label;if(void 0!=b.articles.items[c+1].sm_image_url&&void 0!=b.articles.items[c+1].sm_image_url[0])var j=b.articles.items[c+1].sm_image_url[0];else var j=null}}else if(c==b.articles.items.length-1){if(void 0!=b.articles.items&&void 0!=b.articles.items[c-1]){var e=b.articles.items[c-1].id,f=b.articles.items[c-1].label;if(void 0!=b.articles.items[c-1].sm_image_url&&void 0!=b.articles.items[c-1].sm_image_url[0])var g=b.articles.items[c-1].sm_image_url[0];else var g=null}}else{if(void 0!=b.articles.items&&void 0!=b.articles.items[c-1]){var e=b.articles.items[c-1].id,f=b.articles.items[c-1].label;if(void 0!=b.articles.items[c-1].sm_image_url&&void 0!=b.articles.items[c-1].sm_image_url[0])var g=b.articles.items[c-1].sm_image_url[0];else var g=null}if(void 0!=b.articles.items&&void 0!=b.articles.items[c+1]){var h=b.articles.items[c+1].id,i=b.articles.items[c+1].label;if(void 0!=b.articles.items[c+1].sm_image_url&&void 0!=b.articles.items[c+1].sm_image_url[0])var j=b.articles.items[c+1].sm_image_url[0];else var j=null}}return{idPrec:e,labelPrec:f,imgPrec:g,idSuiv:h,labelSuiv:i,imgSuiv:j}}return{}},a.pagePrecedente=function(b,c){a.int_val(a.page)>1&&e.path("/profil/"+d.id+"/"+(a.int_val(a.page)-1))},a.pageSuivante=function(b,c){a.int_val(a.page)<a.comptePage(c.TPage)&&e.path("/profil/"+d.id+"/"+(a.int_val(a.page)+1))},a.retourRecherche=function(a){"reseau_realisation"==a?e.path("/realisations"):"article_edito"==a?e.path("/actualites"):e.path("/")},a.afficheTextarea=function(){jQuery("#afficheTextarea").show(400)},a.affichePartage=function(){jQuery("#affichePartage").show(400)},jQuery("a.test").fancybox()}]),app.controller("articlesCtrl",["$scope","$log","$location","ArticleFactory","$route","$anchorScroll",function(a,b,c,d,e,f){a.articles=!1,a.themes=!1,a.entity_types=!1,a.$location=c,a.nb_page=0,a.ws=!1,a.type_realisations=!1,a.type_travaux=!1,a.rubriques=!1,a.Math=window.Math,a.largeur=window.innerWidth,"/actualites"==c.path()&&(a.filter.entity_type="article_edito"),"/realisations"==c.path()&&(a.filter.entity_type="reseau_realisation"),"/"==c.path()&&(a.filter.entity_type=""),("/"==c.path||"/actualites"==c.path||"/realisations"==c.path)&&("article_edito"==a.filter.entity_type&&c.path("/actualites"),"reseau_realisation"==a.filter.entity_type&&c.path("/realisations"),""==a.filter.entity_type&&c.path("/")),a.pageChanged=function(){b.log("Page changed to: "+a.currentPage)},a.int_val=function(a){return parseInt(a)},d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b}),a.search=function(b){""==a.filter.keywords&&delete a.filter.keywords,d.getArticles(b).then(function(b){a.articles=b.items,a.ws=b})},a.sortScore=function(b){""!=a.filter.sort_order&&delete a.filter.sort_order,a.filter.score=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.filterPage=function(b){a.filter.page=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b}),c.hash("top"),f()},a.sortDate=function(b){""!=a.filter.score&&delete a.filter.score,a.filter.sort_order=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.sortByTheme=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.theme=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.sortByRubrique=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.rubrique=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.sortByEntityType=function(b){a.filter.entity_type=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.sortByType_real=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.type_realisation=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.sortByType_travaux=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.type_trav=b,d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.removeFilters=function(b,c){delete a.filter[b],d.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b}),d.getEntityTypes().then(function(b){a.menuToggle.entity_types=b})},a.imgResize=function(a){return a.replace("medium","medium_auto/300-200-c")},a.clicImage=function(a){return a.replace("medium","big")},a.removeAllFilters=function(b){angular.forEach(b,function(b,c){delete a.filter[c]}),d.getArticles(b).then(function(b){a.articles=b.items,a.ws=b}),c.path("/"),e.reload(),d.getEntityTypes().then(function(b){a.menuToggle.entity_types=b})},a.changeEntity=function(b){angular.forEach(a.filter,function(b,c){delete a.filter[c]}),a.filter.entity_type=b},a.afficheBarreBasse=function(){jQuery("#barreBasse").show(400)},d.getThemes().then(function(b){a.menuToggle.themes=b}),d.getEntityTypes().then(function(b){a.menuToggle.entity_types=b}),d.getType_realisations().then(function(b){a.menuToggle.type_realisations=b}),d.getType_travaux().then(function(b){a.menuToggle.type_travaux=b}),d.getRubriques().then(function(b){a.menuToggle.rubriques=b}),a.$log=b}]),app.controller("pubsCtrl",["$scope","$log","PubFactory",function(a,b,c){a.pubs=!1,a.$log=b,a.pubFactory=c,c.getPubs().then(function(b){a.pubs=b})}]),app.controller("identificationCtrl",["$scope",function(a){var b=a.slides=[];b.push({icon:"fa-th-list",image:"http://img1.mxstatic.com/wallpapers/3e77ac698f3900e44e410d844cba8e89_large.jpeg",text:"Des milliers d'articles n'attendent que vous",title:"Découvrez des réalisations avec leur description"}),b.push({icon:"fa-th-large",image:"http://www.hdwallpapersos.com/wp-content/uploads/2015/04/Full-Hd-Wallpapers-1920x1080.jpg",text:"Admirez nos nombreuses images",title:"Inspirez-vous des réalisations grâce à ce mode visuel"}),b.push({icon:"fa-briefcase",image:"http://t.wallpaperweb.org/wallpaper/nature/1920x1080/canadanaturecorner1920x1080wallpaper10144.jpg",text:"Observez ses réalisations et prenez des idées",title:"Trouvez un pro"});var c=a.connexion=[];c.push({image:"http://img0.mxstatic.com/wallpapers/8364c61d7574406a358405c80a86d8f0_large.jpeg"}),a.identification=function(){var b={etat:"OK",info_user:{name:"Federer",firstname:"Roger"}};"OK"==b.etat?(a.user.nom=b.info_user.name,a.user.prenom=b.info_user.firstname,a.user.isConnected=!0,localStorage.setItem("user",JSON.stringify(a.user)),$location.path("/")):jQuery("#erreur-connexion").removeClass("hide")}}]),app.controller("photosCtrl",["$scope","ArticleFactory","$anchorScroll","$location","$routeParams",function(a,b,c,d,e){a.entity_types=!1,a.ws=!1,a.articles=!1,a.image=void 0==e.image?1:e.image,a.$routeParams=e,a.filter.entity_type="reseau_realisation",b.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b}),a.sortByEntityType=function(c){a.filter.page="1","toutes"==c?a.filter.entity_type="reseau_realisation OR article_edito":a.filter.entity_type=c,b.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})},a.filterPage=function(e){a.filter.page=e,b.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b}),d.hash("top"),c()},a.int_val=function(a){return parseInt(a)},a.search=function(c){""==a.filter.keywords&&delete a.filter.keywords,b.getArticles(c).then(function(b){a.articles=b.items,a.ws=b})}}]),app.controller("profilProCtrl",["$scope","$location","ArticleFactory",function(a,b,c){a.progress=!1,a.location=b,a.articles=!1,a.ws=!1,a.resetActive=function(a,c){jQuery("#row_step div").each(function(){jQuery(this).hasClass("activestep")&&jQuery(this).removeClass("activestep")}),jQuery("#"+a).hasClass("col-md-2")&&jQuery("#"+a).addClass("activestep"),void 0!=c&&b.path(c)},a.afficheTel=function(){a.largeur>="1200"||jQuery("#afficheTel").show(400)},("/profilPro/vueEnsemble"==b.path()||"/profilPro"==b.path())&&a.resetActive("mpp_ve"),"/profilPro/photoProjet"==b.path()&&a.resetActive("mpp_photo"),"/profilPro/servicesPro"==b.path()&&a.resetActive("mpp_secteurs"),c.getArticles(a.filter).then(function(b){a.articles=b.items,a.ws=b})}]),app.directive("resizable",["$window",function(a){return function(b){return angular.element(a).bind("resize",function(){return b.largeur=a.innerWidth,b.$apply()})}}]);